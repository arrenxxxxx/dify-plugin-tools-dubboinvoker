# Dubbo调用器 - Dify插件

一个强大的Dify插件，用于调用Dubbo服务。支持直接连接Dubbo服务或通过注册中心（如ZooKeeper、Nacos）进行服务发现。完全支持复杂参数类型，包括嵌套对象、集合、Map以及多参数方法调用。

[![English](https://img.shields.io/badge/Language-English-blue)](README.md)
[![中文简体](https://img.shields.io/badge/Language-简体中文-red)](README_zh.md)

🚀 Dubbo调用器 — 为AI应用提供强大的Dubbo服务调用能力！

Dubbo调用器专为Dify平台设计，提供了完整的Dubbo服务集成解决方案，让您的AI应用能够无缝调用企业级微服务。

## 🌟 主要特性

* 注册中心支持 - 支持Nacos注册中心服务发现
* 直连调用模式 - 无需注册中心即可直接调用Dubbo服务
* 复杂参数类型 - 支持所有Java类型，包括基本类型、对象、泛型集合、数组
* 多参数调用 - 支持多参数方法调用，精确类型指定
* 原生协议兼容 - 使用Dubbo原生协议（Hessian序列化）调用服务
* 多协议框架 - 可扩展的多协议支持框架（当前实现Dubbo原生协议）

## 📦 安装

### 前置条件
- Dify v1.0.0 或更高版本
- 能够访问您的Dubbo服务或注册中心的网络环境

### 安装方法

#### 方法1：从Dify应用市场安装
```bash
# 在Dify工作区中
插件 → 应用市场 → 搜索"Dubbo调用器" → 安装
```

#### 方法2：本地包安装
```bash
# 下载.difypkg文件后
插件 → 本地安装 → 上传包文件 → 安装
```

#### 方法3：从GitHub安装（开发版）
```bash
# 克隆仓库
git clone https://github.com/your-repo/dify-plugin-dubbo-invoker.git
cd dify-plugin-dubbo-invoker

# 打包插件
dify plugin package ./

# 安装生成的.difypkg文件
```

## 🚀 快速开始

### 预授权配置

在开始使用工具之前，建议先配置预授权参数以优化Dubbo调用：

1. **进入工具配置**
   - 在Dify工作区中，进入 **插件 → 已安装插件**
   - 找到 **Dubbo调用器** 插件
   - 点击 **配置** 按钮

2. **配置预授权参数**

| 配置项 | 默认值 | 说明 | 示例 |
|--------|--------|------|------|
| **Dubbo版本** | 2.4.10 | 指定Dubbo协议版本，影响序列化兼容性 | `2.4.10`, `2.6.x`, `2.7.15`, `3.0.1` |
| **调用超时时间** | 60000ms | Dubbo服务调用的超时时间（毫秒） | `30000` (30秒), `120000` (2分钟) |

**配置说明：**
- **Dubbo版本**：选择与您的服务端兼容的Dubbo版本，确保序列化协议匹配
- **超时时间**：根据服务响应时间设置合理的超时值，范围：1ms - 300000ms（5分钟）

### 在Dify界面中配置工具

1. **添加工具到工作流**
   - 进入您的Dify工作区
   - 创建新工作流或编辑现有工作流
   - 添加**工具**节点到工作流

2. **选择Dubbo调用器工具**
   - 在工具选择面板中，找到**Dubbo调用器**（调用Dubbo服务）
   - 点击添加到工作流

3. **配置工具参数**
   - 配置面板将打开，显示输入字段
   - 预授权配置的Dubbo版本和超时时间将自动应用

### 基本配置示例

```yaml
# 简单字符串列表方法调用
注册中心地址: nacos://192.168.3.111:8848
接口名称: io.example.api.HelloService
方法名称: sayHelloList
参数类型: java.util.List<java.lang.String>
参数值: ["张三", "李四", "王五"]
```

### 复杂对象列表方法调用

```yaml
# 复杂对象列表方法
注册中心地址: nacos://192.168.3.111:8848
接口名称: io.example.api.UserService
方法名称: batchCreateUsers
参数类型: java.util.List<io.example.dto.UserRequest>
参数值: >
  [
    {"name":"张三","age":25,"email":"zhangsan@example.com"},
    {"name":"李四","age":30,"email":"lisi@example.com"}
  ]
```

### 多参数方法调用

```yaml
# 多参数混合类型调用
注册中心地址: nacos://192.168.3.111:8848
接口名称: io.example.api.UserService
方法名称: updateUser
参数类型: java.lang.Long,io.example.dto.UserRequest,java.lang.Boolean
参数值: >
  [
    123, 
    {"name":"张三","age":26,"email":"zhangsan@example.com"}, 
    true
  ]
```

### 直连方式调用

```yaml
# 不使用注册中心的直连调用
服务URI: dubbo://192.168.3.55:20880
接口名称: io.example.api.UserService
方法名称: getUserById
参数类型: java.lang.Long
参数值: 123
```

## 📋 支持的参数类型

### 基本类型和包装类
- `int`, `long`, `float`, `double`, `boolean`, `byte`, `short`, `char`
- `java.lang.Integer`, `java.lang.String`, `java.lang.Boolean` 等

### 复杂类型
- **自定义对象**：任何Java POJO类
- **集合类型**：`java.util.List<T>`, `java.util.Map<K,V>`, `java.util.Set<T>`
- **数组类型**：`int[]`, `String[]`, `CustomObject[]`
- **嵌套对象**：支持任意深度的对象嵌套

## 🔧 配置字段详解

### 预授权配置字段

这些配置在插件级别设置，对所有调用生效：

| 字段 | 类型 | 默认值 | 说明 |
|------|------|--------|----------|------|
| **Dubbo版本** | String | 2.4.10 | Dubbo协议版本，影响序列化兼容性 |
| **调用超时时间** | String | 60000 | 所有Dubbo调用的超时时间 |

**版本兼容性指南：**
- `2.4.x` - 经典版本，与大多数老系统兼容
- `2.6.x` - 稳定版本，推荐用于生产环境
- `2.7.x` - 新特性版本，支持更多协议
- `3.0.x` - 最新版本，云原生特性

### 必填字段（界面中标记为"Required"）

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| **接口名称** | String | 是 | 完整的Dubbo接口类名 | `io.example.api.UserService` |
| **方法名称** | String | 是 | 要调用的方法名 | `getUserById` |

### 连接配置（二选一）

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| **注册中心地址** | String | 可选* | 注册中心服务器地址 | `nacos://192.168.3.111:8848` |
| **服务URI** | String | 可选* | 直连服务URI地址 | `dubbo://127.0.0.1:20880` |

*注意：注册中心地址和服务URI必须提供其中一个（不能同时提供）

### 参数配置（可选）

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| **参数类型** | String | 可选 | Java参数类型，多个用逗号分隔 | `java.lang.String,java.lang.Integer` |
| **参数值** | String | 可选 | JSON格式的参数值 | `["张三", 25]` |

## 🔧 配置技巧

### 预授权配置最佳实践

#### 🎯 Dubbo版本选择建议

**查看服务端版本：**
```bash
# 检查服务端Dubbo版本
grep dubbo pom.xml
# 或查看服务启动日志
```

**版本匹配策略：**
- 优先选择与服务端完全一致的版本
- 如不确定，使用默认版本

#### ⏱️ 超时时间设置建议

**根据服务类型调整：**
- 查询类服务：`30000ms` (30秒)
- 计算类服务：`60000ms` (60秒) - 默认值
- 复杂业务服务：`120000ms` (2分钟)
- 批量处理服务：`300000ms` (5分钟)

### 字段验证规则

1. **注册中心地址或服务URI**：必须精确填写其中一个，同时填写时使用直连方式
2. **完整接口名**：必须使用完整的Java类名，包含包路径
3. **精确方法名**：方法名必须与Dubbo服务中的方法名完全匹配
4. **完整泛型类型**：对于集合类型，必须指定完整的泛型类型
5. **有效JSON格式**：参数值必须是有效的JSON格式
6. **Dubbo版本格式**：必须符合 `主版本.次版本.修订版本` 或 `主版本.次版本.x` 格式
7. **超时时间范围**：必须在 1-300000 毫秒范围内

### 在配置中使用变量

您可以在任何字段中使用Dify工作流变量：

```yaml
注册中心地址: {{registry_url}}
接口名称: {{service_interface}}
方法名称: getUserById
参数类型: java.lang.Long
参数值: {{user_id}}
```

**快速变量插入：**
- 在任何字段中输入 `/` 可查看可用变量
- 从下拉列表中选择
- 变量格式为 `{{variable_name}}`

### 常见配置错误

#### ❌ 错误示例
```yaml
# 预授权配置错误
Dubbo版本: 2.4                             # 版本格式不完整
调用超时时间: 0                            # 超时时间无效
调用超时时间: 500000                       # 超过最大限制

# 工具参数配置错误
参数类型: java.util.List                    # 缺少泛型类型
参数值: "param1", 123, "param2"            # 多参数未使用数组格式
注册中心地址: nacos://192.168.3.111:8848      # 同时填写了两个连接字段
服务URI: dubbo://127.0.0.1:20880              # 应该只使用其中一个
```

#### ✅ 正确示例
```yaml
# 预授权配置正确
Dubbo版本: 2.6.x                           # 正确的版本格式
调用超时时间: 60000                        # 合理的超时时间（毫秒）

# 工具参数配置正确
参数类型: java.util.List<java.lang.String>  # 包含完整泛型类型
参数值: ["param1", 123, "param2"]          # 多参数使用JSON数组
注册中心地址: nacos://192.168.3.111:8848      # 只使用一种连接方式
服务URI: [空]                              # 另一个保持空白
```

## 🏗️ 架构设计

本插件基于可扩展的协议框架设计：

### 1. Dubbo原生协议
- 使用Hessian序列化格式，与Java Dubbo服务完全兼容
- 支持复杂对象的自动序列化和反序列化

### 2. 智能类型转换系统
- 自动识别并转换JSON到Java对象
- 支持嵌套对象和集合的递归转换
- 泛型类型信息保留，确保类型安全
- 特别优化List、Map等集合类型的处理

### 3. 多协议支持框架
- 可扩展的协议处理架构
- 当前实现：Dubbo原生协议
- 计划支持：Triple协议、REST协议

## 🗺️ 发展路线图

### 当前版本 (v1.0.0)
- ✅ Dubbo原生协议支持
- ✅ Nacos注册中心集成
- ✅ 复杂参数类型处理
- ✅ 智能类型转换
- ✅ 多参数调用

### 即将发布 (v1.1.0)
- 🔄 **ZooKeeper注册中心支持**：完整的ZooKeeper集成服务发现
- 🔄 **Triple协议支持**：基于gRPC的Triple协议实现

## ⚠️ 重要提示

### 配置注意事项
- **预授权配置**：建议在首次使用前配置Dubbo版本和超时时间，避免后续调用问题
- **版本兼容性**：确保配置的Dubbo版本与服务端兼容，版本不匹配可能导致序列化错误
- **网络访问**：确保您有权限访问配置的注册中心或服务地址
- **超时设置**：服务调用超时默认为60秒，可通过预授权配置调整（1ms-300000ms）
- **性能优化**：合理设置超时时间，避免过长的等待影响工作流性能

### 故障排除
- **调用超时**：检查网络连接和服务响应时间，适当增加超时配置
- **序列化错误**：检查Dubbo版本配置是否与服务端匹配
- **连接失败**：验证注册中心地址或直连URI的正确性

## 🤝 贡献

欢迎贡献代码、问题报告和功能请求！

### 如何贡献

1. Fork本仓库
2. 创建您的功能分支 (`git checkout -b feature/amazing-feature`)
3. 提交您的更改 (`git commit -m '添加一些很棒的功能'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 打开一个Pull Request

## 📄 许可证

本项目基于 [Apache License 2.0](LICENSE) 许可证开源。

## 关于

为Dify平台提供Dubbo服务调用能力。

### 主题标签

 dify-plugin  dubbo  rpc  microservices  nacos  zookeeper  java  service-discovery 

### 资源

 📄 说明文档 
